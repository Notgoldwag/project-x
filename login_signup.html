<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!--=============== REMIXICONS ===============-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.2.0/remixicon.css" />

  <!--=============== CSS ===============-->
  <link rel="stylesheet" href="static/css/styles.css" />
  <link rel="stylesheet" href="static/css/extra.css" />

  <!--=============== SUPABASE ===============-->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <title>Login/Registration</title>
</head>

<body>
  <!--=============== ANIMATED BACKGROUND ===============-->
  <div class="lava-background">
    <div class="lava-blob blob-1"></div>
    <div class="lava-blob blob-2"></div>
    <div class="lava-blob blob-3"></div>
  </div>
  <div class="particle-overlay"></div>

  <!--=============== WELCOME MESSAGE ===============-->
  <div class="welcome-message">
    <h1>Welcome to Project X</h1>
  </div>

  <!--=============== LOGIN IMAGE ===============-->
  <svg class="login__blob" viewBox="0 0 566 840" xmlns="http://www.w3.org/2000/svg">
    <mask id="mask0" mask-type="alpha">
      <path d="M342.407 73.6315C388.53 56.4007 394.378 17.3643 391.538 
            0H566V840H0C14.5385 834.991 100.266 804.436 77.2046 707.263C49.6393 
            591.11 115.306 518.927 176.468 488.873C363.385 397.026 156.98 302.824 
            167.945 179.32C173.46 117.209 284.755 95.1699 342.407 73.6315Z" />
    </mask>

    <g mask="url(#mask0)">
      <path d="M342.407 73.6315C388.53 56.4007 394.378 17.3643 391.538 
            0H566V840H0C14.5385 834.991 100.266 804.436 77.2046 707.263C49.6393 
            591.11 115.306 518.927 176.468 488.873C363.385 397.026 156.98 302.824 
            167.945 179.32C173.46 117.209 284.755 95.1699 342.407 73.6315Z" />

      <!-- Insert your image (recommended size: 1000 x 1200) -->
      <image class="login__img" href="static/images/bgintro.png" />
    </g>
  </svg>

  <!--=============== LOGIN ===============-->
  <div class="login container grid" id="loginAccessRegister">
    <!--===== LOGIN ACCESS =====-->
    <div class="login__access">
      <h1 class="login__title">Login</h1>

      <div class="login__area">
        <form action="" class="login__form">
          <div class="login__content grid">
            <div class="login__box">
              <input type="email" id="email" required placeholder=" " class="login__input" />
              <label for="email" class="login__label">Email</label>

              <i class="ri-mail-fill login__icon"></i>
            </div>

            <div class="login__box">
              <input type="password" id="password" required placeholder=" " class="login__input" />
              <label for="password" class="login__label">Password</label>

              <i class="ri-eye-off-fill login__icon login__password" id="loginPassword"></i>
            </div>
          </div>

          <button type="submit" class="login__button">Login</button>
        </form>

        <p class="login__switch">
          Don't have an account?
          <button id="loginButtonRegister">Create Account</button>
        </p>
      </div>

    </div>

    <!--===== REGISTER =====-->
    <div class="login__register">
      <br />
      <br />

      <h1 class="login__title">Create New Account</h1>

      <div class="login__area">
        <form action="" class="login__form" id="WealthifyRegister">
          <div class="login__content grid">
            <div class="login__group grid">
              <div class="login__box">
                <input type="text" id="fullName" required placeholder=" " class="login__input" />
                <label for="fullName" class="login__label">Full Name</label>

                <i class="ri-user-fill login__icon"></i>
              </div>
            </div>

            <div class="login__box">
              <input type="email" id="emailCreate" required placeholder=" " class="login__input" />
              <label for="emailCreate" class="login__label">Email</label>

              <i class="ri-mail-fill login__icon"></i>
            </div>

            <div class="login__box">
              <input type="password" id="passwordCreate" required placeholder=" " class="login__input" />
              <label for="passwordCreate" class="login__label">Password</label>

              <i class="ri-eye-off-fill login__icon login__password" id="loginPasswordCreate"></i>
            </div>
          </div>

          <button type="submit" class="login__button">Create account</button>
        </form>

        <p class="login__switch">
          Already have an account?
          <button id="loginButtonAccess">Log In</button>
        </p>
      </div>
    </div>
  </div>

  <!-- Modal Backdrop -->
  <div id="modalBackdrop" style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
      "></div>

  <!-- Custom Modal -->
  <div id="customModal" style="
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(10, 17, 22, 0.95);
        backdrop-filter: blur(20px);
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(0, 203, 160, 0.3);
        z-index: 1000;
        transition: opacity 0.3s ease-in-out;
      ">
    <p id="modalMessage" style="
          font-size: 16px;
          margin-bottom: 20px;
          font-weight: bold;
          color: #ffffff;
        "></p>
    <button onclick="closeModal()" style="
          padding: 12px 24px;
          background: linear-gradient(135deg, #00cba0 0%, #00a085 100%);
          color: white;
          border: none;
          border-radius: 8px;
          cursor: pointer;
          font-weight: 600;
          transition: all 0.3s ease;
        ">
      OK
    </button>
  </div>

  <!--=============== MAIN JS ===============-->
  <script src="static/js/index.js"></script>
  <script>
    // Close the modal
    function closeModal() {
      document.getElementById("customModal").style.display = "none";
      document.getElementById("modalBackdrop").style.display = "none";
    }
  </script>

  <!--=============== SUPABASE AUTH ===============-->
  <script type="module">
    // Initialize Supabase
    const { createClient } = supabase;
    const supabaseUrl = 'https://qnbvnczctgbclolvkjcb.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFuYnZuY3pjdGdiY2xvbHZramNiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI1NTg3NDIsImV4cCI6MjA3ODEzNDc0Mn0.v5t8eMJjpPtdIn6oKXshjuIH0shlztIp9fWBrRjnrGg';
    const supabaseClient = createClient(supabaseUrl, supabaseKey);

    // Check if already authenticated and redirect
    async function checkAuth() {
      const { data: { session } } = await supabaseClient.auth.getSession();
      if (session) {
        window.location.href = '/home';
      }
    }

    // Login form handler
    document.querySelector('.login__access .login__form').addEventListener('submit', async (e) => {
      e.preventDefault();

      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      if (!email || !password) {
        showMessage('Please fill in all fields', 'error');
        return;
      }

      try {
        const { data, error } = await supabaseClient.auth.signInWithPassword({
          email: email,
          password: password
        });

        if (error) {
          showMessage(error.message, 'error');
        } else {
          showMessage('Login successful! Redirecting...', 'success');
          setTimeout(() => {
            window.location.href = '/home';
          }, 1000);
        }
      } catch (error) {
        showMessage('Login failed: ' + error.message, 'error');
      }
    });

    // Registration form handler
    document.getElementById('WealthifyRegister').addEventListener('submit', async (e) => {
      e.preventDefault();

      const email = document.getElementById('emailCreate').value;
      const password = document.getElementById('passwordCreate').value;
      const fullName = document.getElementById('fullName').value;

      if (!email || !password || !fullName) {
        showMessage('Please fill in all fields', 'error');
        return;
      }

      if (password.length < 6) {
        showMessage('Password must be at least 6 characters long', 'error');
        return;
      }

      try {
        const { data, error } = await supabaseClient.auth.signUp({
          email: email,
          password: password,
          options: {
            data: {
              full_name: fullName
            }
          }
        });

        if (error) {
          showMessage(error.message, 'error');
        } else {
          showMessage('Account created successfully! Check your email for verification.', 'success');
        }
      } catch (error) {
        showMessage('Registration failed: ' + error.message, 'error');
      }
    });

    // Show message function
    function showMessage(message, type) {
      // Create or get existing message element
      let messageEl = document.getElementById('auth-message');
      if (!messageEl) {
        messageEl = document.createElement('div');
        messageEl.id = 'auth-message';
        messageEl.style.cssText = `
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 10000;
            transition: all 0.3s ease;
          `;
        document.body.appendChild(messageEl);
      }

      // Set colors based on type
      if (type === 'success') {
        messageEl.style.background = 'linear-gradient(135deg, #00cba0 0%, #00a085 100%)';
      } else {
        messageEl.style.background = 'linear-gradient(135deg, #ff4757 0%, #ff3742 100%)';
      }

      messageEl.textContent = message;
      messageEl.style.display = 'block';

      // Hide after 3 seconds
      setTimeout(() => {
        messageEl.style.display = 'none';
      }, 3000);
    }

    // Check auth on page load
    checkAuth();
  </script>

  <script type="module" src="static/js/signup.js"></script>
  <script type="module" src="static/js/login.js"></script>
</body>

</html>